<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>How to add a new Wireguard user - NoLogs VPN documentation</title><meta name="description" content="In this post I will show you how to create new users for your Wireguard VPN instance."><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://kb.nologs-vpn.com/how-to-add-a-new-wireguard-user/"><link rel="alternate" type="application/atom+xml" href="https://kb.nologs-vpn.com/feed.xml"><link rel="alternate" type="application/json" href="https://kb.nologs-vpn.com/feed.json"><meta property="og:title" content="How to add a new Wireguard user"><meta property="og:image" content="https://kb.nologs-vpn.com/media/posts/6/undraw_secure_server_s9u8.png"><meta property="og:site_name" content="NoLogs VPN documentation"><meta property="og:description" content="In this post I will show you how to create new users for your Wireguard VPN instance."><meta property="og:url" content="https://kb.nologs-vpn.com/how-to-add-a-new-wireguard-user/"><meta property="og:type" content="article"><link rel="stylesheet" href="https://kb.nologs-vpn.com/assets/css/style.css?v=b5aa1360bb88d0be44b2141e3b10bad5"><link rel="stylesheet" href="https://kb.nologs-vpn.com/assets/css/prism-dark.css?v=77202604b9c81e0cfc60210c4810d09c"><link rel="stylesheet" href="https://kb.nologs-vpn.com/assets/css/docsearch.css?v=0407a7a131feaf753e76cd9d86149dc2"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://kb.nologs-vpn.com/how-to-add-a-new-wireguard-user/"},"headline":"How to add a new Wireguard user","datePublished":"2020-10-25T02:22","dateModified":"2020-10-25T03:16","image":{"@type":"ImageObject","url":"https://kb.nologs-vpn.com/media/posts/6/undraw_secure_server_s9u8.png","height":880,"width":1106},"description":"<p>In this post I will show you how to create new users for your Wireguard VPN instance.</p>\n","author":{"@type":"Person","name":"Romeo Mihalcea"},"publisher":{"@type":"Organization","name":"Romeo Mihalcea"}}</script></head><body><header class="header" id="js-header"><a class="logo" href="https://kb.nologs-vpn.com/">NoLogs VPN documentation</a></header><main><div class="container"><div class="content content--center"><article class="post"><h1>How to add a new Wireguard user</h1><figure class="post__featured-image"><img class="hero__image-img" src="https://kb.nologs-vpn.com/media/posts/6/undraw_secure_server_s9u8.png" srcset="https://kb.nologs-vpn.com/media/posts/6/responsive/undraw_secure_server_s9u8-xs.png 300w, https://kb.nologs-vpn.com/media/posts/6/responsive/undraw_secure_server_s9u8-sm.png 480w, https://kb.nologs-vpn.com/media/posts/6/responsive/undraw_secure_server_s9u8-md.png 749w" sizes="(max-width: 749px) 100vw, 749px" loading="eager" height="880" width="1106" alt="How to add a new Wireguard user"></figure><div class="post__entry"><p>In this post I will show you how to create new users for your Wireguard VPN instance.</p><p>For this operation to be possible you will need to have root access to your server. If you don't know how to gain that, please <a href="https://kb.nologs-vpn.com/how-to-access-the-console-of-your-vm/">follow our guide</a>.</p><h3>Generate Wireguard client keys</h3><p><a href="https://kb.nologs-vpn.com/how-to-access-the-console-of-your-vm/"></a>After logging in the ssh console you need to create the keys for the new user. Wireguard uses these keys to keep track of peers and authenticate them:</p><pre>docker run --rm cmulk/wireguard-docker:buster genkeys</pre><p>This will print 2 keys: a public and a private one:</p><pre>-e Private Key: 8JlkyYRuR/OdFlBOUDVfM+DknvUUsjtnduNoEeqsLWA=<br>-e Public Key: KglpBFVBdJhCIkrs8ZK/EZhkSkslz873CroBAEsg/2I=</pre><p>You have to copy both of them so we can go ahead with our next step (ommit the <code>-e Private Key</code> and <code>-e Public Key</code> bits).</p><h3>Configure the server and add the new user</h3><p>Now that we have our keys it is time to edit the main configuration file for Wireguardby running:</p><pre>nano /etc/wireguard/wg0.conf</pre><p>nano is a console editor and it will let you modify the file which looks something like this when being edited:</p><pre>[Interface]<br>Address = 192.168.20.1/24<br>SaveConfig = true<br>PostUp = iptables -A FORWARD -i wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE<br>PostDown = iptables -D FORWARD -i wg0 -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE<br>ListenPort = 5555<br>PrivateKey = 6IrKiXy2jdMxu9MQwh5Tl+EqxltMWPQvPv9at5YOrlQ=<br><br>[Peer]<br>PublicKey = hgx2jsPIsp6E2cltv1BIgf+YHQVBuazsvt6XuceHTXk=<br>AllowedIPs = 192.168.20.2/32</pre><p>We can see there are 2 sections here:</p><ol><li>Interface</li><li>Peer</li></ol><p>The Interface part is about the server and the Peer is actually the first client that is allowed to connect. You can see that the first peer has a <code>PublicKey</code> (like the one you just generated) and an <code>AllowedIPs</code> param. We will need to replicate that and create a new <code>Peer</code> so the new config will look like this:</p><pre>[Interface]<br>Address = 192.168.20.1/24<br>SaveConfig = true<br>PostUp = iptables -A FORWARD -i wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE<br>PostDown = iptables -D FORWARD -i wg0 -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE<br>ListenPort = 5555<br>PrivateKey = 6IrKiXy2jdMxu9MQwh5Tl+EqxltMWPQvPv9at5YOrlQ=<br><br>[Peer]<br>PublicKey = hgx2jsPIsp6E2cltv1BIgf+YHQVBuazsvt6XuceHTXk=<br>AllowedIPs = 192.168.20.2/32<br><br>[Peer]<br>PublicKey = KglpBFVBdJhCIkrs8ZK/EZhkSkslz873CroBAEsg/2I=<br>AllowedIPs = 192.168.20.3/32</pre><p>Look carefully and take note that I added a new <code>Peer</code> with the public key we just generated above and I also incremented the <code>AllowedIPs</code> from <code>192.168.20.2/32</code> to <code>192.168.20.3/32</code> to avoid any IP space collisions.</p><p>You can save the file by pressing <code>CTRL+X</code> and writing the letter <code>y</code> once prompted to save the changes.</p><p>Following this change you need to restart the Wireguard instance:</p><pre>docker restart $(docker ps -aq)</pre><h3>Create the client config file</h3><p>There's one more step and that is to create the new client config that the new member should use to connect. For this let's create a copy of the original client.config file and edit the Interface part. The Peer, in this case, is the server so that section needs to stay the same:</p><pre class="aLF-aPX-K0-aPE">[Interface]
Address = 192.168.20.3/24
PrivateKey = 8JlkyYRuR/OdFlBOUDVfM+DknvUUsjtnduNoEeqsLWA=
ListenPort = 0 

[Peer]
PublicKey = g4gaGC/F2Fz3E2cH7Ek1ZQTRTEHosZQ4oEOzpf6e/y0=
Endpoint = 165.227.147.194:58281
AllowedIPs = 0.0.0.0/0,::/0 #makes sure ALL traffic routed through VPN
PersistentKeepalive = 25</pre><p>What I edited here is the Interface <code>Address</code> to the one we allocated to our new user (<code>192.168.20.3</code>) and the <code>PrivateKey</code> which I updated with the private key that we generated above: <code>8JlkyYRuR/OdFlBOUDVfM+DknvUUsjtnduNoEeqsLWA=</code> . Other than that pretty much remained the same.</p><p>That's it! I know it is a bit difficult and we're working on automating this process in the future.</p><footer><div class="post__footer"><dl class="post__meta"><dt>Created:</dt><dd><time datetime="2020-10-25T02:22">October 25, 2020</time></dd><dt>Updated:</dt><dd><time datetime="2020-10-25T03:16">October 25, 2020</time></dd></dl><div class="post__share"><button class="post__share-button" aria-label="Share"><svg width="32" height="32"><use xlink:href="https://kb.nologs-vpn.com/assets/svg/svg-map.svg#share"></use></svg></button><div class="post__share-popup"></div></div><dl class="post__tag"><dt>Tags:</dt><dd><a href="https://kb.nologs-vpn.com/tag-/server/" title="server">server</a></dd><dd><a href="https://kb.nologs-vpn.com/tag-/user/" title="user">user</a></dd><dd><a href="https://kb.nologs-vpn.com/tag-/wireguard/" title="wireguard">wireguard</a></dd></dl></div><div class="post__related"><h3>Similar posts:</h3><ul><li><a href="https://kb.nologs-vpn.com/how-to-add-a-new-user-to-your-vpn-instance/" title="How to add a new user to your VPN instance">How to add a new user to your VPN instance</a></li><li><a href="https://kb.nologs-vpn.com/how-to-add-a-new-openvpn-user/" title="How to add a new OpenVPN user">How to add a new OpenVPN user</a></li></ul></div><nav><ul class="post__nav"><li class="post__nav-prev">Prev: <a href="https://kb.nologs-vpn.com/how-to-add-a-new-openvpn-user/" rel="prev" title="How to add a new OpenVPN user">How to add a new OpenVPN user</a></li><li class="post__nav-next">Next: <a href="https://kb.nologs-vpn.com/how-to-add-a-new-user-to-your-vpn-instance/" rel="next" title="How to add a new user to your VPN instance">How to add a new user to your VPN instance</a></li></ul></nav></footer></div></article></div></div></main><footer class="footer"><div><a class="footer__logo" href="https://kb.nologs-vpn.com/">NoLogs VPN documentation</a></div><div><div class="footer__copy">nologs-vpn.com</div><div class="footer__social"></div></div></footer><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true
   };</script><script defer="defer" src="https://kb.nologs-vpn.com/assets/js/scripts.min.js?v=81031dd8b8055af4df2ab226f57f75f0"></script><script>var images = document.querySelectorAll('img[loading]');

        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script><script defer="defer" src="https://kb.nologs-vpn.com/assets/js/prism.js?v=277309e26a038bf312a7e8aa239cfbd8"></script><script defer="defer" src="https://kb.nologs-vpn.com/assets/js/prism-line-numbers.min.js?v=13275d3ac10d7028cf6a6f5da276f68c"></script><script defer="defer" src="https://kb.nologs-vpn.com/assets/js/prism-copy-to-clipboard.min.js?v=fabfc3fd9af83cda5208ba2e9f9ed238"></script><script src="https://kb.nologs-vpn.com/assets/js/docsearch.min.js?v=9db7c9eaa8e736ce16840e5bbc02047b"></script><script>docsearch({
                        apiKey: '',
                        indexName: '',
                        inputSelector: '#docsearch-input',
                        debug: false
                });</script></body></html>